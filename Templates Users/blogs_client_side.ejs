<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fitness & Wellness Blog</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="/CSS/footer.css" />
    <link rel="stylesheet" href="/CSS/blogs.css" />
    <style>
      /* Enhanced styling for better readability */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Improve featured post display */
      .featured-post {
        display: flex;
        flex-direction: column;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 40px;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        background-color: #fff;
      }

      .featured-post:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      .featured-image {
        height: 300px; /* Smaller height */
        overflow: hidden;
      }

      .featured-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
      }

      .featured-post:hover .featured-image img {
        transform: scale(1.05);
      }

      .featured-content {
        padding: 24px;
      }

      .featured-content h2 {
        font-size: 24px; /* Smaller font size */
        line-height: 1.3;
        margin: 10px 0;
        color: #333;
      }

      /* Improve post cards */
      .posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 24px;
      }

      .post-card {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        background-color: #fff;
        height: 100%;
        display: flex;
        flex-direction: column;
        cursor: pointer;
      }

      .post-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
      }

      .post-image {
        height: 180px; /* Smaller image size */
        overflow: hidden;
      }

      .post-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
      }

      .post-card:hover .post-image img {
        transform: scale(1.05);
      }

      .post-content {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }

      .post-content h3 {
        font-size: 18px; /* Smaller font size */
        line-height: 1.3;
        margin: 8px 0;
        color: #333;
      }

      .post-content p {
        font-size: 14px;
        line-height: 1.5;
        color: #666;
        margin-bottom: 15px;
        flex-grow: 1;
      }

      /* Better tag styling */
      .tag {
        display: inline-block;
        padding: 6px 12px;
        background-color: #4CAF50;
        color: white;
        border-radius: 50px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      /* Better post meta styling */
      .post-meta {
        display: flex;
        justify-content: space-between;
        color: #777;
        font-size: 13px;
        margin-top: auto;
      }

      /* Better loading indicator */
      .loading-indicator {
        text-align: center;
        padding: 20px;
        color: #555;
        font-style: italic;
      }

      /* Improve category buttons */
      .category-buttons-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 30px;
      }

      .category-btn {
        padding: 8px 16px;
        border: none;
        background-color: #f0f0f0;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .category-btn.active {
        background-color: #4CAF50;
        color: white;
      }

      .category-btn:hover:not(.active) {
        background-color: #e0e0e0;
      }

      /* Responsive improvements */
      @media (min-width: 768px) {
        .featured-post {
          flex-direction: row;
          height: 320px;
        }
        
        .featured-image {
          width: 50%;
          height: auto;
        }
        
        .featured-content {
          width: 50%;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
      }

      @media (max-width: 767px) {
        .featured-post {
          margin-bottom: 30px;
        }
        
        .posts-grid {
          grid-template-columns: 1fr;
        }
        
        .post-image {
          height: 200px;
        }
      }

      /* Blog Modal Styles */
      .blog-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.7);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .blog-modal.show {
        display: block;
        opacity: 1;
      }

      .modal-content {
        background-color: #fff;
        margin: 5% auto;
        padding: 30px;
        border-radius: 12px;
        width: 85%;
        max-width: 800px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        position: relative;
        max-height: 85vh;
        overflow-y: auto;
      }

      .close-modal {
        position: absolute;
        top: 15px;
        right: 20px;
        color: #555;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.2s;
        z-index: 10;
      }

      .close-modal:hover {
        color: #000;
      }

      .modal-blog-header {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
      }

      .modal-blog-header h2 {
        font-size: 28px;
        margin-bottom: 10px;
      }

      .modal-blog-meta {
        display: flex;
        justify-content: space-between;
        color: #777;
        font-size: 14px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .modal-blog-content {
        font-size: 16px;
        line-height: 1.7;
        color: #444;
      }

      .modal-blog-content p {
        margin-bottom: 15px;
      }

      .modal-blog-content img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 15px 0;
      }

      .modal-blog-content h3 {
        font-size: 22px;
        margin: 25px 0 15px;
      }

      .modal-blog-content ul, .modal-blog-content ol {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      .modal-blog-content li {
        margin-bottom: 8px;
      }

      .modal-blog-image {
        width: 100%;
        max-height: 400px;
        overflow: hidden;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .modal-blog-image img {
        width: 100%;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <!-- <nav>
      <div id="nav-placeholder"></div>
    </nav> -->
    <%- include('nav_bar') %>
    <!-- Removed the gradient-bar div -->
    <div class="container">
      <header class="header">
        <h1>Fitness & Wellness Blog</h1>
        <p>Expert insights to support your fitness journey</p>

        <div class="category-buttons-wrapper">
          <button class="category-btn active" data-category="all">All</button>
          <button class="category-btn" data-category="Training">Training</button>
          <button class="category-btn" data-category="Nutrition">Nutrition</button>
          <button class="category-btn" data-category="Wellness">Wellness</button>
          <button class="category-btn" data-category="Fitness Tips">Fitness Tips</button>
          <button class="category-btn" data-category="Tips">Tips</button>
        </div>
      </header>

      <!-- Blog reading modal -->
      <div id="blog-modal" class="blog-modal">
        <div class="modal-content">
          <span class="close-modal">&times;</span>
          <div id="modal-blog-content"></div>
        </div>
      </div>

      <!-- Featured post - will be populated with the most recent blog -->
      <article class="featured-post" id="featured-post">
        <div class="featured-image">
          <img src="/Fitness.jpeg" />
          <div class="image-placeholder">Featured Image (800 x 400)</div>
        </div>
        <div class="featured-content">
          <span class="tag">Training</span>
          <h2>The Science Behind Effective Weight Training</h2>
          <div class="post-meta">
            <span>Dr. Sarah Johnson</span>
            <span>March 15, 2024</span>
          </div>
        </div>
      </article>

      <section class="recent-posts">
        <h2>Recent Articles</h2>
        <div class="posts-grid" id="posts-grid">
          <!-- Posts will be loaded here dynamically -->
          <div class="loading-indicator">Loading blogs...</div>
        </div>
      </section>
    </div>
    <footer>
      <div id="footer"></div>
    </footer>
    <script>
      $(function () {
        $("#nav-placeholder").load("Nav_bar.html");
      });
      fetch("footer.html")
        .then((response) => response.text())
        .then((data) => (document.getElementById("footer").innerHTML = data));

      // Load and display blogs
      document.addEventListener("DOMContentLoaded", function () {
        // Variables to store all blogs and current filter
        let allBlogs = [];
        let currentCategory = 'all';

        // Fetch blogs from API
        function fetchBlogs() {
          fetch('/api/blogs')
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to fetch blogs');
              }
              return response.json();
            })
            .then(data => {
              console.log('Blogs fetched:', data);
              if (data.success && data.blogs && data.blogs.length > 0) {
                allBlogs = data.blogs;
                displayBlogs(allBlogs);
              } else {
                // Show default content or "no blogs" message
                document.querySelector('#posts-grid').innerHTML = '<p>No blogs available at the moment.</p>';
              }
            })
            .catch(error => {
              console.error('Error fetching blogs:', error);
              document.querySelector('#posts-grid').innerHTML = '<p>Error loading blogs. Please try again later.</p>';
            });
        }

        // Display blogs based on current filter
        function displayBlogs(blogs) {
          // Sort blogs by date (most recent first)
          blogs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

          // If we have blogs, use the first one as featured
          if (blogs.length > 0) {
            displayFeaturedBlog(blogs[0]);
            
            // Display the rest of the blogs
            const postsGrid = document.getElementById('posts-grid');
            postsGrid.innerHTML = '';
            
            // Start from index 1 (second blog) since first is featured
            const remainingBlogs = blogs.slice(1);
            
            if (remainingBlogs.length === 0) {
              postsGrid.innerHTML = '<p>No additional articles available.</p>';
              return;
            }
            
            remainingBlogs.forEach(blog => {
              // Format date
              const blogDate = new Date(blog.createdAt);
              const formattedDate = blogDate.toLocaleDateString('en-US', {
                month: 'long',
                day: 'numeric',
                year: 'numeric'
              });
              
              // Create shortened content preview
              const contentPreview = blog.content.replace(/<[^>]*>/g, '').substring(0, 100) + '...';
              
              const blogCard = document.createElement('article');
              blogCard.className = 'post-card';
              blogCard.innerHTML = `
                <div class="post-image">
                  <img src="${blog.featuredImage}" alt="${blog.title}" />
                </div>
                <div class="post-content">
                  <span class="tag">${blog.category}</span>
                  <h3>${blog.title}</h3>
                  <p>${contentPreview}</p>
                  <div class="post-meta">
                    <span>${blog.authorName}</span>
                    <span>${formattedDate}</span>
                  </div>
                </div>
              `;
              
              // Add click event to view full blog
              blogCard.addEventListener('click', function() {
                // Instead of alert, show blog in a modal for better UX
                showBlogModal(blog);
              });
              
              postsGrid.appendChild(blogCard);
            });
          } else {
            // No blogs available, show default content
            document.querySelector('#posts-grid').innerHTML = '<p>No blogs available at the moment.</p>';
          }
        }

        // Display featured blog
        function displayFeaturedBlog(blog) {
          const featuredPost = document.getElementById('featured-post');
          
          // Format date
          const blogDate = new Date(blog.createdAt);
          const formattedDate = blogDate.toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
            year: 'numeric'
          });
          
          featuredPost.innerHTML = `
            <div class="featured-image">
              <img src="${blog.featuredImage}" alt="${blog.title}" />
            </div>
            <div class="featured-content">
              <span class="tag">${blog.category}</span>
              <h2>${blog.title}</h2>
              <div class="post-meta">
                <span>${blog.authorName}</span>
                <span>${formattedDate}</span>
              </div>
            </div>
          `;
          
          // Add click event to view full blog
          featuredPost.addEventListener('click', function() {
            // Instead of alert, show blog in a modal for better UX
            showBlogModal(blog);
          });
        }

        // Filter blogs by category
        function filterBlogs(category) {
          if (category === 'all') {
            displayBlogs(allBlogs);
          } else {
            const filteredBlogs = allBlogs.filter(blog => blog.category === category);
            displayBlogs(filteredBlogs);
          }
        }

        // Category button click handlers
        const categoryBtns = document.querySelectorAll(".category-btn");
        categoryBtns.forEach((button) => {
          button.addEventListener("click", function () {
            // Remove active class from all buttons
            categoryBtns.forEach((btn) => btn.classList.remove("active"));
            // Add active class to clicked button
            this.classList.add("active");

            // Get category and filter blogs
            const category = this.getAttribute('data-category');
            currentCategory = category;
            filterBlogs(category);
          });
        });

        // Initial fetch of blogs
        fetchBlogs();
        
        // Function to show blog in modal
        function showBlogModal(blog) {
          const modal = document.getElementById('blog-modal');
          const modalContent = document.getElementById('modal-blog-content');
          
          // Format date
          const blogDate = new Date(blog.createdAt);
          const formattedDate = blogDate.toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
            year: 'numeric'
          });
          
          // Create modal content
          modalContent.innerHTML = `
            <div class="modal-blog-header">
              <span class="tag">${blog.category}</span>
              <h2>${blog.title}</h2>
              <div class="modal-blog-meta">
                <span>By: ${blog.authorName}</span>
                <span>Published: ${formattedDate}</span>
              </div>
            </div>
            <div class="modal-blog-image">
              <img src="${blog.featuredImage}" alt="${blog.title}">
            </div>
            <div class="modal-blog-content">
              ${blog.content}
            </div>
          `;
          
          // Show modal with animation
          modal.style.display = 'block';
          setTimeout(() => {
            modal.classList.add('show');
          }, 10);
          
          // Handle close button
          const closeBtn = document.querySelector('.close-modal');
          closeBtn.onclick = closeModal;
          
          // Close when clicking outside the modal content
          window.onclick = function(event) {
            if (event.target === modal) {
              closeModal();
            }
          };
          
          // Handle escape key
          document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
              closeModal();
            }
          });
          
          function closeModal() {
            modal.classList.remove('show');
            setTimeout(() => {
              modal.style.display = 'none';
            }, 300); // Match the CSS transition time
          }
        }
      });
    </script>
  </body>
</html>
